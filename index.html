<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>æ·±å½± æ­Œãƒªã‚¹ãƒˆ</title>

  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
      background-color: black;
      color: #aaaaaa;
    }

    /* å…¨ä½“ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç¸¦ä¸¦ã³ */
    #content {
      display: flex;
      flex-direction: column;
      gap: 20px;
      padding: 10px 20px;
      align-items: center;
      max-width: 1100px;
      margin: 0 auto;
      box-sizing: border-box;
    }

    /* ä¸Šæ®µï¼šå‹•ç”»ã¨æ­Œæ ä¸€è¦§ã®æ¨ªä¸¦ã³ */
    #topRow {
      display: flex;
      gap: 20px;
      align-items: flex-start;
      width: 100%;
      max-width: 1100px;
      box-sizing: border-box;
      justify-content: center;
    }

    /* å‹•ç”»ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ */
    #playerContainer {
      flex: 1 1 60%;
      max-width: 640px;
      background-color: #111;
      padding: 10px 16px;
      border-radius: 8px;
      color: white;
      text-align: center;
      box-sizing: border-box;
      margin: 0 auto;
    }

    #playerHeader {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 4px 0 8px 0;
      font-size: 16px;
      font-weight: bold;
      border-bottom: 1px solid #333;
    }

    .navButtons button {
      background-color: #333;
      color: white;
      border: none;
      padding: 4px 10px;
      margin-left: 6px;
      cursor: pointer;
      font-size: 14px;
    }

    #playerFooter {
      margin-top: 6px;
    }

    #playerFooter a {
      color: #1e90ff;
      text-decoration: none;
      font-size: 13px;
    }

    /* æ­Œæ ä¸€è¦§ */
    #frameListWrapper {
      flex: 1 1 40%;
      max-width: 400px;
      background-color: #111;
      color: #fff;
      padding: 10px;
      border-radius: 8px;
      overflow-x: hidden;
      box-sizing: border-box;
      max-height: 500px;

      display: flex;
      flex-direction: column;
    }

    #frameListTitle {
      margin-top: 0;
      font-size: 16px;
      padding-bottom: 4px;
      border-bottom: 1px solid #444;
    }

    /* ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã‚‚æŠ˜ã‚Šè¿”ã™ã‚ˆã†ã« */
    #frameListTabs {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin: 6px 0;
      overflow-x: hidden;
      max-width: 100%;
      box-sizing: border-box;
    }

    #frameListTabs button {
      background-color: #333;
      border: none;
      color: white;
      padding: 4px 8px;
      cursor: pointer;
      font-size: 14px;
    }

    #frameListTabs button.active {
      background-color: #555;
      font-weight: bold;
    }

    #frameListPages {
      flex: 1;
      overflow-y: auto;
      border-top: 1px solid #444;
      padding-top: 6px;
    }

    .frameListPage {
      display: none;
    }

    .frameListPage.active {
      display: block;
    }

    #frameList {
      list-style: none;
      padding-left: 0;
      margin-top: 8px;
    }

    #frameList li {
      padding: 6px 4px;
      border-bottom: 1px solid #333;
      cursor: pointer;
      color: white;
    }

    #frameList li:hover {
      background-color: #222;
    }

    /* ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã¯ä¸Šæ®µã®ä¸‹ */
    #playlist {
      width: 100%;
      max-width: 1100px;
      border-top: 1px solid #666;
      padding-top: 10px;
      background-color: black;
      color: #aaaaaa;
      max-height: 360px;
      overflow-y: auto;
      box-sizing: border-box;
    }

    /* å…±é€šãƒ—ãƒ¬ã‚¤ãƒ‘ãƒ¼ãƒ„ */
    .playparts {
      padding: 10px;
      cursor: pointer;
      border-bottom: 1px solid #aaa;
      color: white;
    }

    .playparts:last-child {
      border-bottom: none;
    }

    .songtitle {
      color: white;
      font-size: 16px;
    }

    .artist,
    .time {
      font-size: 12px;
      color: #aaa;
    }

    /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
    #header {
      background-color: #333;
      color: white;
      display: flex;
      flex-wrap: nowrap;
      overflow-x: auto;
      justify-content: center;
      padding: 5px;
      gap: 6px;
      text-align: center;
      box-sizing: border-box;
    }

    #header button {
      background-color: #444;
      border: none;
      color: white;
      cursor: pointer;
      margin-right: 8px;
      flex: 1 1 auto;
      min-width: 80px;
      padding: 6px 8px;
      font-size: 14px;
      white-space: nowrap;
      box-sizing: border-box;
      transition: background-color 0.3s;
    }

    #header button:last-child {
      margin-right: 0;
    }

    #header button:hover {
      background-color: #666;
    }

    /* ã‚¿ãƒ–UI */
    #tabContainer {
  position: static; /* fixed â†’ staticã« */
  bottom: auto;
  left: auto;
  right: auto;
  z-index: auto;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  border-top: 1px solid #333;
  padding: 10px 0;
  background-color: #000;
  width: 100%;
  max-width: 640px; /* å¿…è¦ãªã‚‰ */
  margin: 0 auto; /* ä¸­å¤®å¯„ã› */
}


    #tabButtons {
  display: flex;
  gap: 4px;
  border-bottom: 1px solid #444;
  background-color: #111;
  padding: 0 10px;
  max-width: 640px;
  box-sizing: border-box;
  justify-content: center;
  margin: 0 auto;
}


    #tabButtons button {
      flex: 1;
      padding: 8px 0;
      background-color: #333;
      color: white;
      border: none;
      border-radius: 6px 6px 0 0;
      cursor: pointer;
      font-size: 16px;
    }

    #tabButtons button.active {
      background-color: #555;
      font-weight: bold;
    }

    .tabContent {
      background-color: #111;
      color: #aaa;
      padding: 10px;
      border-radius: 0 6px 6px 6px;
      max-height: 400px;
      overflow-y: auto;
      display: none;
      width: 100%;
      max-width: 640px;
      box-sizing: border-box;
    }

    .tabContent.active {
      display: block;
    }

    #frameListContainer.mobileTab,
    #playlist.mobileTab {
      width: 100%;
      max-width: none;
      box-sizing: border-box;
      max-height: none;
      overflow-y: auto;
    }

    /* ãƒ¡ãƒ‡ã‚£ã‚¢ã‚¯ã‚¨ãƒª */

    @media (max-width: 1080px) {
      #frameListWrapper {
        display: none; /* PCç‰ˆãƒªã‚¹ãƒˆã¯éè¡¨ç¤º */
      }

      #tabContainer {
        display: flex; /* ã‚¿ãƒ–UIè¡¨ç¤º */
        justify-content: center;
        gap: 20px;
      }

  #tabContents {
    display: flex;
    justify-content: center;
    gap: 20px;
  }
  
 

      #playlist {
        max-width: 640px;
      }

      #content {
        padding: 10px;
        align-items: center;
      }

      #topRow {
        flex-direction: column;
        width: 100%;
        max-width: 640px;
      }

      #playerContainer {
        width: 100%;
        max-width: 640px;
        padding: 10px;
      }

      #header button {
        font-size: 12px;
        min-width: 60px;
        padding: 4px 6px;
      }

      #playerHeader {
        flex-direction: column;
        align-items: flex-start;
      }

      .navButtons {
        margin-top: 4px;
      }

      .navButtons button {
        padding: 4px 8px;
        font-size: 12px;
      }

      #playerFooter a {
        font-size: 12px;
      }

      .playparts {
        padding: 6px;
      }

      .songtitle {
        font-size: 14px;
      }

      .artist,
      .time {
        font-size: 12px;
      }

      /* iframe é«˜ã•å›ºå®š */
      #playerContainer iframe {
        height: 360px !important;
        max-height: 100%;
        width: 100% !important;
      }
    }

    @media (max-width: 480px) {
      #header button {
        font-size: 12px;
        min-width: 60px;
        padding: 4px 6px;
      }
    }

    *, *::before, *::after {
      box-sizing: border-box;
    }

    html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    overflow-x: hidden;
  }
  .playlistPage {
    display: none;
  }
  .playlistPage.active {
    display: block;
  }

  .frameListPage {
    display: none;
  }
  .frameListPage.active {
    display: block;
  }

  #playlistTabs button.active,
  #frameListTabs button.active {
    background-color: #444;
    color: white;
  }

  .selected-frame {
    color: red;
    font-weight: bold;
  }

  .hidden {
  display: none;
}

  </style>

  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>

  <script>
    // ã‚¿ãƒ–ã®è¡¨ç¤ºåˆ‡æ›¿ã¨åˆæœŸåŒ–
    function setupTabButtons() {
      const tabButtons = document.querySelectorAll('#tabButtons button');
      const tabContents = document.querySelectorAll('.tabContent');

      tabButtons.forEach((button, i) => {
        button.addEventListener('click', () => {
          tabButtons.forEach(btn => btn.classList.remove('active'));
          button.classList.add('active');

          tabContents.forEach(content => content.classList.remove('active'));
          if (tabContents[i]) tabContents[i].classList.add('active');
        });
      });
    }

    // iframeã®é«˜ã•ã‚’ãƒ¢ãƒã‚¤ãƒ«ã§å›ºå®šï¼ˆ1080pxä»¥ä¸‹ï¼‰
    function adjustIframeHeight() {
      const iframe = document.querySelector("#playerContainer iframe");
      if (!iframe) return;

      if (window.innerWidth <= 1080) {
        iframe.style.height = '360px';
        iframe.style.width = '100%';
      } else {
        iframe.style.height = '';
        iframe.style.width = '';
      }
    }

    // content ã® padding-bottom ã‚’ã‚¿ãƒ–ã®é«˜ã•ã«åˆã‚ã›ã¦èª¿æ•´
    function adjustContentPadding() {
      const tab = document.querySelector('#tabContainer');
      const content = document.querySelector('#content');
      if (!tab || !content) return;

      const tabHeight = tab.getBoundingClientRect().height;
      content.style.paddingBottom = `${tabHeight + 20}px`; // ä½™è£•ã‚’æŒãŸã›ã‚‹
    }

    // ãƒªã‚µã‚¤ã‚ºæ™‚ã®å‡¦ç†ã¾ã¨ã‚
    function handleResize() {
      adjustIframeHeight();
      adjustContentPadding();
    }

    window.addEventListener('DOMContentLoaded', async () => {
  await fetchCSVData();
  setTimeout(() => {
    renderFrameList();
    renderPlaylistWithTabs();
    setupTabButtons();
    handleResize();
    syncFrameListHeight();
    copyContentToMobilePlaylist();
  }, 500);
});


    window.addEventListener('resize', () => {
      handleResize();
    });
    window.addEventListener('DOMContentLoaded', async () => {
  await fetchCSVData();
  renderFrameList();
  renderPlaylistWithTabs();

  renderMobileFrameList(frameList);
  renderMobilePlaylist();

  setupTabButtons();
  handleResize();
  syncFrameListHeight();
});

window.addEventListener('resize', () => {
  handleResize();
  renderMobileFrameList(frameList);
  syncFrameListHeight();
});

  </script>
</head>



  <body>

    


<div id="content">
  <div id="topRow">
    <div id="playerContainer">
      <div id="playerHeader">
        <span>Now Playing</span>
        <div class="navButtons">
          <button id="prevBtn">â—€</button>
          <button id="nextBtn">â–¶</button>
        </div>
      </div>
      <div id="player"></div>
      <div id="playerFooter" class="hidden">
        <a id="youtubeLink" href="#" target="_blank" rel="noopener noreferrer">â–¶ YouTubeã§è¦‹ã‚‹</a>
      </div>
      <div id="playerButtons" class="navButtons" style="margin-top: 12px; text-align: center;">
        <button id="resetButton">å…ƒã«æˆ»ã™</button>
        <button id="shuffleButton">ã‚·ãƒ£ãƒƒãƒ•ãƒ«</button>
        <button id="dedupButton">è¢«ã‚Šãªã—</button>
        <button id="dedupShuffleButton">è¢«ã‚Šãªã—ã‚·ãƒ£ãƒƒãƒ•ãƒ«</button>
      </div>
<div id="searchContainer" style="margin-top: 12px; text-align: center;">
  <input
    type="text"
    id="searchInput"
    placeholder="æ›²åã¾ãŸã¯ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆåã§æ¤œç´¢"
    style="width: 80%; max-width: 320px; padding: 6px 10px; font-size: 14px; border-radius: 4px 0 0 4px; border: 1px solid #444; background-color: #222; color: white;"
  />
  <button
    id="searchButton"
    style="padding: 6px 12px; font-size: 14px; border-radius: 0 4px 4px 0; border: 1px solid #444; border-left: none; background-color: #333; color: white; cursor: pointer;"
    title="æ¤œç´¢"
  >
    ğŸ”
  </button>
</div>


    </div>

    <div id="frameListWrapper">
      <h3 id="frameListTitle">æ­Œæ ä¸€è¦§</h3>
      <div id="frameListTabs"></div>
      <div id="frameListPages"></div>
    </div>
  </div>

  <div id="playlist">
    <div id="playlistWrapper">
  <div id="playlistTabs"></div>
  <div id="playlistPages"></div>
</div>
  </div>

  <!-- ãƒ¢ãƒã‚¤ãƒ«ç”¨ã‚¿ãƒ–UIï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯éè¡¨ç¤ºï¼‰ -->
<div id="tabContainer" style="display:none;">
  <div id="tabButtons">
    <button id="tabPlaylist" class="active">ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆ</button>
    <button id="tabFrameList">æ­Œæ ä¸€è¦§</button>
    
  </div>
  <div id="tabContents">
     <div id="playlistMobile" class="tabContent active">
  <div id="playlistMobilePaginationTop"></div> <!-- ğŸ”¼ ä¸Šã«è¿½åŠ  -->
  <div id="playlistMobileContent"></div>        <!-- æ›²ãƒªã‚¹ãƒˆæœ¬ä½“ -->
  <div id="playlistMobilePagination"></div>     <!-- ğŸ”½ æ—¢å­˜ã¾ãŸã¯è¿½åŠ  -->
  </div>
    <div id="frameListMobile" class="tabContent">
  <div id="frameListMobilePaginationTop"></div> <!-- â† ä¸Šéƒ¨ã«ã‚‚è¿½åŠ  -->
  <ul id="frameListMobileList"></ul>
  <div id="frameListMobilePagination"></div> <!-- â† æ—¢å­˜ã®ä¸‹éƒ¨ -->
</div>

   


  </div>
</div>








    <script>
      // å‹•ç”»ãƒªã‚¹ãƒˆ
      // Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®CSVãƒ‡ãƒ¼ã‚¿URL
      const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vS5KPXtSwvF34dTvt8Uhu7TLm7E1oZ_eN5--LJKB0yGGldDfOrKpM4IwqB0ct5q1hjvOjFV05FfHXu_/pub?gid=0&single=true&output=csv';

      async function fetchCSVData() {
  const response = await fetch(csvUrl);
  const rows = (await response.text()).split("\n").map(r => r.split(","));

  const frameList = extractFrameList(rows); // â† ã“ã“ã§å–å¾—

  // â˜… ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆä½œæˆå‡¦ç†ã¯ãã®ã¾ã¾ã§OK
  const playList = rows.slice(2).map(row => {
  const videoUrl = row[4];
  if (!videoUrl) return null;
  const { videoId, startSeconds } = parseYouTubeUrl(videoUrl);
 if (!videoId || row[6] === 'åŸ‹ã‚è¾¼ã¿ä¸å¯' || row[6] === 'éå…¬é–‹') return null;

  const duration = parseInt(row[5], 10);
  const title = row[2];
  const artist = row[3];
  const endSeconds = startSeconds + duration;
  const frameName = row[12]?.trim();  // â† ã“ã“ã§æ åã‚’å–å¾—ï¼ˆMåˆ—ï¼‰

  return { videoId, startSeconds, endSeconds, title, artist, frameName };
}).filter(item => item !== null);


  return { playList, frameList };
}






      // Iframe APIã®æº–å‚™
      var tag = document.createElement('script');
      tag.src = "https://www.youtube.com/iframe_api";
      var firstScriptTag = document.getElementsByTagName('script')[0];
      firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

      // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®è¨­å®š
      var player;
      var playList = [];
      var originalPlayList = []; // å…ƒã®é †ç•ªã‚’ä¿å­˜ã—ã¦ãŠãå¤‰æ•°

      window.onYouTubeIframeAPIReady = async function () {
  const { playList: pList, frameList: fList } = await fetchCSVData();

  playList = pList;
  originalPlayList = JSON.parse(JSON.stringify(pList));
  frameList = fList;

  renderFrameList(); // æ­Œæ ä¸€è¦§æç”»
  renderPlaylistWithTabs();       // ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆæç”»

  copyContentToMobilePlaylist(); // â†ã“ã“ã§ã‚³ãƒ”ãƒ¼

  player = new YT.Player('player', {
    height: '360',
    width: '640',
    events: {
      'onReady': onPlayerReady,
      'onStateChange': onPlayerStateChange
    }
  });
};





      // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æº–å‚™å®Œäº†å¾Œã®å‡¦ç†ï¼ˆæœ€åˆã®å‹•ç”»ã®ã‚»ãƒƒãƒˆï¼‰
      var isReady = false;
      var nowPlaying = 0;
      var isNextVideo = false;

      function onPlayerReady(event) {
        player.cueVideoById(playList[nowPlaying]);
        document.getElementById("song" + nowPlaying).style.color = 'red';
        document.getElementById("song" + nowPlaying).scrollIntoView({ behavior: 'smooth', block: 'center' });
        updateYouTubeLink(); // â† è¿½åŠ 
        isReady = true;
      }

      function onPlayerStateChange(event) {
        if (event.data == YT.PlayerState.ENDED && !isNextVideo) {
          document.getElementById("song" + nowPlaying).style.color = 'white';
          nowPlaying += 1;
          if (playList.length <= nowPlaying) nowPlaying = 0;
          isNextVideo = true;
          player.loadVideoById(playList[nowPlaying]);
          player.playVideo();
          document.getElementById("song" + nowPlaying).style.color = 'red';
          document.getElementById("song" + nowPlaying).scrollIntoView({ behavior: 'smooth', block: 'center' });
          updateYouTubeLink(); // â† è¿½åŠ 
        } else if (event.data == YT.PlayerState.PLAYING && isNextVideo) {
          isNextVideo = false;
        }
      }


      // é…åˆ—ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«ä¸¦ã³æ›¿ãˆã‚‹é–¢æ•°
      function shuffleArray(array) {
  const copied = array.slice();
  for (let i = copied.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [copied[i], copied[j]] = [copied[j], copied[i]];
  }
  return copied;
}

      // åˆæœŸè¡¨ç¤ºæ™‚
renderPlaylistWithTabs();
renderMobilePlaylist();


// ã‚·ãƒ£ãƒƒãƒ•ãƒ«å¾Œ
document.getElementById("shuffleButton").addEventListener("click", () => {
  playList = shuffleArray(originalPlayList); // playList ã‹ã‚‰ã‚·ãƒ£ãƒƒãƒ•ãƒ«ã—ãŸæ–°ãƒªã‚¹ãƒˆ
  nowPlaying = 0;
  renderPlaylistWithTabs();
  renderMobilePlaylist();

  if (playList.length > 0 && isReady) {
    player.cueVideoById(playList[nowPlaying]);
    document.getElementById("song" + nowPlaying).style.color = 'red';
    document.getElementById("playlist").scrollTop = 0;
    copyContentToMobilePlaylist();
  }
});



      document.getElementById("dedupButton").addEventListener("click", function () {
        // å…ƒã®é †ç•ªã®ãƒªã‚¹ãƒˆã‹ã‚‰è¢«ã‚Šé™¤å»
        const deduped = removeDuplicatesFromPlaylist(originalPlayList);
        playList = deduped;
        nowPlaying = 0;
        renderPlaylistWithTabs();
  renderMobilePlaylist();
        player.cueVideoById(playList[nowPlaying]);
        document.getElementById("song" + nowPlaying).style.color = 'red';
        document.getElementById("playlist").scrollTop = 0;
        copyContentToMobilePlaylist()
      });

      document.getElementById("resetButton").addEventListener("click", function () {
        playList = JSON.parse(JSON.stringify(originalPlayList)); // å…ƒã®é †ç•ªã«æˆ»ã™
        nowPlaying = 0;
        renderPlaylistWithTabs();
  renderMobilePlaylist();
        player.cueVideoById(playList[nowPlaying]);
        document.getElementById("song" + nowPlaying).style.color = 'red';
        document.getElementById("playlist").scrollTop = 0;
        copyContentToMobilePlaylist()
      });

      document.getElementById("dedupShuffleButton").addEventListener("click", function () {
        const deduped = removeDuplicatesFromPlaylist(originalPlayList);
        playList = shuffleArray(deduped);
        nowPlaying = 0;
        renderPlaylistWithTabs();
  renderMobilePlaylist();
        player.cueVideoById(playList[nowPlaying]);
        document.getElementById("song" + nowPlaying).style.color = 'red';
        document.getElementById("playlist").scrollTop = 0;
        copyContentToMobilePlaylist()
      });

      document.getElementById("prevBtn").addEventListener("click", function () {
        if (!isReady) return;
        document.getElementById("song" + nowPlaying).style.color = 'white';
        nowPlaying = (nowPlaying - 1 + playList.length) % playList.length;
        player.loadVideoById(playList[nowPlaying]);
        document.getElementById("song" + nowPlaying).style.color = 'red';
        document.getElementById("song" + nowPlaying).scrollIntoView({ behavior: 'smooth', block: 'center' });
        updateYouTubeLink();
        copyContentToMobilePlaylist()
      });

      document.getElementById("nextBtn").addEventListener("click", function () {
        if (!isReady) return;
        document.getElementById("song" + nowPlaying).style.color = 'white';
        nowPlaying = (nowPlaying + 1) % playList.length;
        player.loadVideoById(playList[nowPlaying]);
        document.getElementById("song" + nowPlaying).style.color = 'red';
        document.getElementById("song" + nowPlaying).scrollIntoView({ behavior: 'smooth', block: 'center' });
        updateYouTubeLink();
        copyContentToMobilePlaylist()
      });

      
      // ãƒªã‚¹ãƒˆã‚’ã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸæ™‚ã®å‡¦ç†
      function pushList (id) {
        if (!isReady) return;
        document.getElementById("song" + nowPlaying).style.color = 'white';
        nowPlaying = Number(id);
        player.loadVideoById(playList[nowPlaying]);
        document.getElementById("song" + nowPlaying).style.color = 'red';
        document.getElementById("song" + nowPlaying).scrollIntoView({ behavior: 'smooth', block: 'center' });
      }

      // YouTubeã®URLã‹ã‚‰ videoId ã¨ startSeconds ã‚’æŠ½å‡ºã™ã‚‹é–¢æ•°
      function parseYouTubeUrl(url) {
      const idMatch = url.match(/(?:v=|youtu\.be\/|\/live\/)([a-zA-Z0-9_-]{11})/);
      const videoId = idMatch ? idMatch[1] : null;

      // å†ç”Ÿç§’æ•°ã‚’æŠ½å‡ºï¼ˆt=45 ã‚„ &t=90s ãªã©ï¼‰
      let startSeconds = 0;
      const timeMatch = url.match(/[?&]t=(\d+)(s)?/);
      if (timeMatch && timeMatch[1]) {
      startSeconds = parseInt(timeMatch[1], 10);
      }

      return { videoId, startSeconds };
      }

      // é‡è¤‡ã‚’æ’é™¤ï¼ˆå¾Œæ–¹ã‚’å„ªå…ˆï¼‰
      function removeDuplicatesFromPlaylist(playlist) {
        const seen = new Map();
        for (let i = playlist.length - 1; i >= 0; i--) {
          const key = playlist[i].title.trim() + '|' + playlist[i].artist.trim();
          if (!seen.has(key)) {
            seen.set(key, playlist[i]);
          }
        }
        return Array.from(seen.values()).reverse(); // å…ƒã®é †ã«æˆ»ã™
      }

      function updateYouTubeLink() {
        const videoId = playList[nowPlaying].videoId;
        const startSeconds = playList[nowPlaying].startSeconds || 0;
        const url = `https://www.youtube.com/watch?v=${videoId}&t=${startSeconds}s`;
        document.getElementById('youtubeLink').href = url;
      }

      function renderFrameList() {
  const tabsContainer = document.getElementById("frameListTabs");
  const pagesContainer = document.getElementById("frameListPages");
  tabsContainer.innerHTML = "";
  pagesContainer.innerHTML = "";

  const pageSize = 10;
  const totalPages = Math.ceil(frameList.length / pageSize);

  for (let i = 0; i < totalPages; i++) {
    // ã‚¿ãƒ–ãƒœã‚¿ãƒ³ä½œæˆ
    const tabBtn = document.createElement("button");
    tabBtn.textContent = i + 1;
    if (i === 0) tabBtn.classList.add("active");
    tabBtn.addEventListener("click", () => {
      document.querySelectorAll(".frameListPage").forEach(p => p.classList.remove("active"));
      document.querySelectorAll("#frameListTabs button").forEach(b => b.classList.remove("active"));
      document.getElementById(`frameListPage${i}`).classList.add("active");
      tabBtn.classList.add("active");
    });
    tabsContainer.appendChild(tabBtn);

    // ãƒšãƒ¼ã‚¸å†…å®¹ä½œæˆ
    const page = document.createElement("div");
    page.classList.add("frameListPage");
    if (i === 0) page.classList.add("active");
    page.id = `frameListPage${i}`;

    const ul = document.createElement("ul");
    ul.style.listStyle = "none";
    ul.style.padding = "0";
    ul.style.margin = "0";

    const pageItems = frameList.slice(i * pageSize, (i + 1) * pageSize);
    pageItems.forEach((frame, index) => {
      const li = document.createElement("li");
      li.textContent = `${frame.date} - ${frame.frameName}`;
      li.style.padding = "6px 4px";
      li.style.borderBottom = "1px solid #333";
      li.style.cursor = "pointer";

      // ã‚°ãƒ¬ãƒ¼ã‚¢ã‚¦ãƒˆå‡¦ç†ï¼ˆåŸ‹ã‚è¾¼ã¿ä¸å¯ or éå…¬é–‹ï¼‰
      if (!frame.isEmbeddable || !frame.videoId) {
        li.style.color = "#888";
      }

      li.addEventListener("click", () => {
        const clickedVideoId = frame.videoId;

        // videoIdãªã—ï¼ˆéå…¬é–‹ãªã©ï¼‰ã¯ä½•ã‚‚ã—ãªã„
        if (!clickedVideoId) return;

        // åŸ‹ã‚è¾¼ã¿ä¸å¯ãªã‚‰YouTubeãƒšãƒ¼ã‚¸ã‚’æ–°ã‚¿ãƒ–ã§é–‹ã
        if (!frame.isEmbeddable) {
          player.loadVideoById(frame.videoId);
  updatePlayingHighlight();
  updateYouTubeLink();
          return;
        }

        // é¸æŠä¸­ã®è‰²ãƒªã‚»ãƒƒãƒˆï¼†ã‚»ãƒƒãƒˆ
        document.querySelectorAll("#frameListPages li").forEach(el => el.classList.remove("selected-frame"));
        li.classList.add("selected-frame");

        // ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã‚’çµã‚Šè¾¼ã¿
        const filteredList = originalPlayList.filter(video => video.videoId === clickedVideoId);

        if (filteredList.length === 0) return;

        playList = filteredList;
        nowPlaying = 0;

        renderPlaylistWithTabs();
        renderMobilePlaylist();

        if (isReady) {
          player.loadVideoById(playList[nowPlaying].videoId, playList[nowPlaying].startSeconds);
          updatePlayingHighlight();
          updateYouTubeLink();
        }

      });

      ul.appendChild(li);
    });

    page.appendChild(ul);
    pagesContainer.appendChild(page);
  }
}




     function extractFrameList(rows) {
  const dataRows = rows.slice(2);

  // æ ä¸€è¦§ï¼ˆL: æ—¥ä»˜, M: æ åï¼‰
  const frameSet = new Map();

  dataRows.forEach(row => {
    const date = row[11]?.trim();     // Låˆ— (ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹11)
    const frameName = row[12]?.trim(); // Måˆ— (ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹12)
    if (date && frameName && !frameSet.has(frameName)) {
      frameSet.set(frameName, { date, frameName });
    }
  });

  // Oåˆ—ãŒç©ºç™½ã§ãªã„è¡Œã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹å–å¾—
  const nonEmptyOColumnIndices = dataRows
    .map((row, index) => ({ index, value: row[14]?.trim() })) // Oåˆ—ã¯14
    .filter(item => item.value !== '')
    .map(item => item.index);

  // Oåˆ—ç©ºç™½ã§ãªã„è¡Œã®Eåˆ—URLã‹ã‚‰å‹•ç”»æƒ…å ±ã‚’å–å¾—
  const videos = nonEmptyOColumnIndices.map(i => {
  const url = dataRows[i][4]; // Eåˆ—(4)
  if (!url) return null;

  const { videoId, startSeconds } = parseYouTubeUrl(url);
  const embedStatus = dataRows[i][6]?.trim(); // Gåˆ—(6)
  const baseFrameName = dataRows[i][14]?.trim() || ''; // Oåˆ—(14)

  let tag = '';
  if (embedStatus === 'éå…¬é–‹') {
    tag = '[éå…¬é–‹]';
  } else if (embedStatus === 'åŸ‹ã‚è¾¼ã¿ä¸å¯') {
    tag = '[åŸ‹ã‚è¾¼ã¿ä¸å¯]';
  }

  const frameName = `${baseFrameName} ${tag}`.trim();
  const isEmbeddable = tag === '';

  return {
    rowIndex: i,
    videoId,
    startSeconds,
    frameName,
    isEmbeddable
  };
}).filter(v => v !== null);


  const frameList = Array.from(frameSet.values()).map((frame, index) => {
  const video = videos[index];
  return {
    ...frame,
    frameName: video ? video.frameName : frame.frameName,  // â˜… ä¿®æ­£ãƒã‚¤ãƒ³ãƒˆ
    videoId: video ? video.videoId : null,
    startSeconds: video ? video.startSeconds : 0,
    isEmbeddable: video ? video.isEmbeddable : false
  };
});




  return frameList;
}










   // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆã®ã‚¤ãƒ™ãƒ³ãƒˆè¨­å®š
function setupTabButtons() {
  const tabFrameList = document.getElementById('tabFrameList');
  const tabPlaylist = document.getElementById('tabPlaylist');
  const frameListMobile = document.getElementById('frameListMobile');
  const playlistMobile = document.getElementById('playlistMobile');

  tabFrameList.addEventListener('click', () => {
    tabFrameList.classList.add('active');
    tabPlaylist.classList.remove('active');
    frameListMobile.classList.add('active');
    playlistMobile.classList.remove('active');
  });

  tabPlaylist.addEventListener('click', () => {
    tabPlaylist.classList.add('active');
    tabFrameList.classList.remove('active');
    playlistMobile.classList.add('active');
    frameListMobile.classList.remove('active');
  });
}



// è¡¨ç¤ºåˆ‡æ›¿ï¼ˆãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œï¼‰
function handleResize() {
  const tabContainer = document.getElementById('tabContainer');
  const frameListWrapper = document.getElementById('frameListWrapper');
  const playlist = document.getElementById('playlist');

  if (window.innerWidth <= 1080) {
    tabContainer.style.display = 'block';
    frameListWrapper.style.display = 'none';
    playlist.style.display = 'none';

    renderMobileFrameList(frameList); // âœ… ã‚¤ãƒ™ãƒ³ãƒˆä»˜ã
    renderMobilePlaylist();           // âœ… ã‚¤ãƒ™ãƒ³ãƒˆä»˜ã
  } else {
    tabContainer.style.display = 'none';
    frameListWrapper.style.display = 'flex';
    playlist.style.display = 'block';
  }

  adjustContentPadding();
}





// iframeé«˜ã•ã‚’frameListã«åˆã‚ã›ã‚‹ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
function syncFrameListHeight() {
  const playerContainer = document.getElementById("playerContainer");
  const iframe = document.querySelector("#player iframe");
  const frameList = document.getElementById("frameListWrapper");

  if (window.innerWidth > 768 && iframe && frameList && playerContainer) {
    const totalHeight = playerContainer.offsetHeight + (iframe.offsetHeight || 360);
    frameList.style.height = totalHeight + "px";
  } else if (frameList) {
    frameList.style.height = "auto";
  }
}

// ã‚¤ãƒ™ãƒ³ãƒˆç™»éŒ²
window.addEventListener('DOMContentLoaded', () => {
  setupTabButtons();
  handleResize();             // â† æœ€åˆã‹ã‚‰ãƒ¢ãƒã‚¤ãƒ«ãƒ»PCã«å¿œã˜ã¦å‡ºã—åˆ†ã‘
  syncFrameListHeight();      // é«˜ã•èª¿æ•´ã‚‚å¿˜ã‚Œãšã«
});

window.addEventListener('resize', () => {
  handleResize();
  syncFrameListHeight();
});

function renderMobileFrameList(frameList) {
  const pageSize = 10;
  const listContainer = document.getElementById("frameListMobileList");
  const paginationTop = document.getElementById("frameListMobilePaginationTop");
  const paginationBottom = document.getElementById("frameListMobilePagination");
  let currentPage = 0;
  let currentSelected = null; // ç¾åœ¨é¸æŠã•ã‚ŒãŸã‚¢ã‚¤ãƒ†ãƒ ã‚’ä¿æŒ

  function renderPage(pageIndex) {
    listContainer.innerHTML = "";
    const start = pageIndex * pageSize;
    const end = start + pageSize;
    const pageItems = frameList.slice(start, end);

    pageItems.forEach((frame, i) => {
      const li = document.createElement("li");
      li.textContent = `${frame.date} - ${frame.frameName}`;
      li.style.padding = "6px 4px";
      li.style.borderBottom = "1px solid #333";

      // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã«ã‚ˆã‚‹ã‚¹ã‚¿ã‚¤ãƒ«è¨­å®š
      if (!frame.isEmbeddable || !frame.videoId) {
        li.style.color = "#888";
      }

      li.addEventListener("click", () => {
        const clickedVideoId = frame.videoId;

        // videoIdãªã—ï¼ˆéå…¬é–‹ãªã©ï¼‰ã¯ä½•ã‚‚ã—ãªã„
        if (!clickedVideoId) return;

        // åŸ‹ã‚è¾¼ã¿ä¸å¯ãªã‚‰YouTubeãƒšãƒ¼ã‚¸ã‚’æ–°ã‚¿ãƒ–ã§é–‹ã
        if (!frame.isEmbeddable) {
          player.loadVideoById(frame.videoId);
  updatePlayingHighlight();
  updateYouTubeLink();
          return;
        }

        if (currentSelected) {
          currentSelected.style.color = 'white'; // ä»¥å‰é¸æŠã—ãŸã‚¢ã‚¤ãƒ†ãƒ ã‚’é»’ã«æˆ»ã™
        }
        li.style.color = 'red'; // ç¾åœ¨é¸æŠã•ã‚ŒãŸã‚¢ã‚¤ãƒ†ãƒ ã‚’èµ¤ã«
        currentSelected = li; // ç¾åœ¨é¸æŠã•ã‚ŒãŸã‚¢ã‚¤ãƒ†ãƒ ã‚’ä¿æŒ

        const filtered = originalPlayList.filter(v => v.videoId === frame.videoId);
        if (filtered.length === 0) return;

        playList = filtered;
        nowPlaying = 0;

        renderPlaylistWithTabs();
        renderMobilePlaylist();

        if (isReady) {
          player.loadVideoById(playList[nowPlaying].videoId, playList[nowPlaying].startSeconds);
          updatePlayingHighlight();
          updateYouTubeLink();
        }
      });

      listContainer.appendChild(li);
    });

    renderPaginationButtons();
  }

  function renderPaginationButtons() {
    paginationTop.innerHTML = "";
    paginationBottom.innerHTML = "";
    const totalPages = Math.ceil(frameList.length / pageSize);
    for (let i = 0; i < totalPages; i++) {
      [paginationTop, paginationBottom].forEach(container => {
        const btn = document.createElement("button");
        btn.textContent = i + 1;
        if (i === currentPage) btn.classList.add("active");
        btn.addEventListener("click", () => {
          currentPage = i;
          renderPage(currentPage);
        });
        container.appendChild(btn);
      });
    }
  }

  renderPage(currentPage);
}





let currentSelected = null; // é¸æŠä¸­ã®ãƒªã‚¹ãƒˆã‚¢ã‚¤ãƒ†ãƒ ä¿æŒ

function copyContentToMobilePlaylist() {

  const playlist = document.getElementById('playlist');
  const playlistMobileContent = document.getElementById('playlistMobileContent');


  if (playlist && playlistMobileContent) {
    playlistMobileContent.innerHTML = '';
    const items = playlist.querySelectorAll('.playparts');
    items.forEach((item, index) => {
      const clone = item.cloneNode(true);
      clone.addEventListener("click", () => {
        if (!isReady) return;
        document.getElementById("song" + nowPlaying).style.color = 'white';
        nowPlaying = index;
        player.loadVideoById(playList[nowPlaying]);
        document.getElementById("song" + nowPlaying).style.color = 'red';
        document.getElementById("song" + nowPlaying).scrollIntoView({ behavior: 'smooth', block: 'center' });
        updateYouTubeLink();
      });
      playlistMobileContent.appendChild(clone);
    });
  }
}

function renderMobilePlaylist() {
  const topPagination = document.getElementById('playlistMobilePaginationTop');
  const bottomPagination = document.getElementById('playlistMobilePagination');
  const contentContainer = document.getElementById('playlistMobileContent');

  const pageSize = 20;
  const totalPages = Math.ceil(playList.length / pageSize);
  let currentPage = 0;

  function renderPage(pageIndex) {
    contentContainer.innerHTML = "";
    const start = pageIndex * pageSize;
    const end = start + pageSize;

    const items = playList.slice(start, end);
    items.forEach((item, index) => {
      const globalIndex = start + index;
      const div = document.createElement("div");
      div.classList.add("playparts");

      div.innerHTML = `
        <p>
          <span class="songtitle">${item.title}</span>
          <span class="time">ï¼ˆ${Math.floor((item.endSeconds - item.startSeconds) / 60)}:${String((item.endSeconds - item.startSeconds) % 60).padStart(2, '0')}ï¼‰</span>
        </p>
        <p class="artist">${item.artist}</p>
      `;

      div.addEventListener("click", () => {
        if (!isReady) return;
        document.getElementById("song" + nowPlaying).style.color = 'white';
        nowPlaying = globalIndex;
        player.loadVideoById(playList[nowPlaying]);
        document.getElementById("song" + nowPlaying).style.color = 'red';
        document.getElementById("song" + nowPlaying).scrollIntoView({ behavior: 'smooth', block: 'center' });
        updateYouTubeLink();
      });

      contentContainer.appendChild(div);
    });

    renderPaginationButtons(pageIndex);
  }

  function renderPaginationButtons(activeIndex) {
    const makeButtons = (container) => {
      container.innerHTML = "";
      for (let i = 0; i < totalPages; i++) {
        const btn = document.createElement("button");
        btn.textContent = i + 1;
        if (i === activeIndex) btn.classList.add("active");

        btn.addEventListener("click", () => {
          currentPage = i;
          renderPage(i);
        });

        container.appendChild(btn);
      }
    };

    makeButtons(topPagination);
    makeButtons(bottomPagination);
  }

  renderPage(currentPage);
}


function renderPlaylistWithTabs() {
  const tabsContainer = document.getElementById("playlistTabs");
  const pagesContainer = document.getElementById("playlistPages");

  tabsContainer.innerHTML = "";
  pagesContainer.innerHTML = "";

  const pageSize = 20;
  const totalPages = Math.ceil(playList.length / pageSize);

  for (let i = 0; i < totalPages; i++) {
    // ã‚¿ãƒ–ãƒœã‚¿ãƒ³ï¼ˆPCç”¨ï¼‰
    const tabBtn = document.createElement("button");
    tabBtn.textContent = i + 1;
    if (i === 0) tabBtn.classList.add("active");

    tabBtn.addEventListener("click", () => {
      document.querySelectorAll(".playlistPage").forEach(p => p.classList.remove("active"));
      document.querySelectorAll("#playlistTabs button").forEach(b => b.classList.remove("active"));
      document.getElementById(`playlistPage${i}`).classList.add("active");
      tabBtn.classList.add("active");
    });

    tabsContainer.appendChild(tabBtn);

    // ãƒšãƒ¼ã‚¸æœ¬ä½“
    const page = document.createElement("div");
    page.classList.add("playlistPage");
    if (i === 0) page.classList.add("active");
    page.id = `playlistPage${i}`;

    const start = i * pageSize;
    const end = start + pageSize;
    const items = playList.slice(start, end);

    items.forEach((item, index) => {
      const globalIndex = start + index;
      const div = document.createElement("div");
      div.classList.add("playparts");

      div.innerHTML = `
        <p>
          <span class="songtitle" id="song${globalIndex}">${item.title}</span>
          <span class="time">ï¼ˆ${Math.floor((item.endSeconds - item.startSeconds) / 60)}:${String((item.endSeconds - item.startSeconds) % 60).padStart(2, '0')}ï¼‰</span>
        </p>
        <p class="artist">${item.artist}</p>
      `;

      div.addEventListener("click", () => {
        if (!isReady) return;
        document.getElementById("song" + nowPlaying).style.color = 'white';
        nowPlaying = globalIndex;
        player.loadVideoById(playList[nowPlaying]);
        document.getElementById("song" + nowPlaying).style.color = 'red';
        document.getElementById("song" + nowPlaying).scrollIntoView({ behavior: 'smooth', block: 'center' });
        updateYouTubeLink();
      });

      page.appendChild(div);
    });

    pagesContainer.appendChild(page);
  }
}

document.addEventListener('DOMContentLoaded', () => {
  const searchInput = document.getElementById('searchInput');
  const searchButton = document.getElementById('searchButton');

  searchButton.addEventListener('click', () => {
    const keyword = searchInput.value.trim().toLowerCase();
    if (!keyword) return;

    const filtered = originalPlayList.filter(item => {
      const title = item.title?.toLowerCase() || '';
      const artist = item.artist?.toLowerCase() || '';
      return title.includes(keyword) || artist.includes(keyword);
    });

    playList = filtered;
    nowPlaying = 0;

    renderPlaylistWithTabs();
    renderMobilePlaylist();

    if (playList.length > 0 && isReady) {
      player.loadVideoById(playList[nowPlaying].videoId, playList[nowPlaying].startSeconds);
      updatePlayingHighlight();
      updateYouTubeLink();
    } else {
      // æ¤œç´¢çµæœãŒ0ä»¶ã ã£ãŸå ´åˆ
      document.getElementById('playlistPages').innerHTML = '<p style="padding: 12px;">è©²å½“ã™ã‚‹æ›²ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>';
      document.getElementById('playlistMobileContent').innerHTML = '<p style="padding: 12px;">è©²å½“ã™ã‚‹æ›²ãŒã‚ã‚Šã¾ã›ã‚“ã€‚</p>';
    }
  });
});


// ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é–¢æ•°ã¯å…ˆã»ã©ã®ã¾ã¾ã§OK
function filterPlaylist(keyword) {
  const playlistPages = document.getElementById('playlistPages');
  if (!playlistPages) return;

  const songs = playlistPages.querySelectorAll('.playparts');
  songs.forEach(song => {
    const titleElem = song.querySelector('.songtitle');
    const artistElem = song.querySelector('.artist');

    const title = titleElem ? titleElem.textContent.toLowerCase() : '';
    const artist = artistElem ? artistElem.textContent.toLowerCase() : '';

    if (title.includes(keyword) || artist.includes(keyword)) {
      song.style.display = '';
    } else {
      song.style.display = 'none';
    }
  });
}

// åˆæœŸçŠ¶æ…‹ã®æœ€å°å¹…ï¼ˆä¾‹ãˆã°1080pxï¼‰
const initialWidth = 480;

// ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®ãƒªã‚µã‚¤ã‚ºã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¡Œã†é–¢æ•°
function resizeWindowSmoothly(targetWidth) {
  const currentWidth = window.innerWidth;
  
  // ç¾åœ¨ã®å¹…ãŒç›®æ¨™å¹…ã«è¿‘ã„å ´åˆã¯ãƒªã‚µã‚¤ã‚ºã‚’åœæ­¢
  if (Math.abs(currentWidth - targetWidth) <= 1) {
    return;
  }

  // æ¬¡ã«è¨­å®šã™ã‚‹å¹…ã‚’å°‘ã—ãšã¤è¿‘ã¥ã‘ã‚‹
  const nextWidth = currentWidth + (targetWidth - currentWidth) / 20;

  // ãƒªã‚µã‚¤ã‚ºã‚’é©ç”¨ï¼ˆãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ä¸Šã§åæ˜ ã•ã‚Œã‚‹ï¼‰
  window.resizeTo(Math.round(nextWidth), window.innerHeight);

  // 0.05ç§’å¾Œã«å†åº¦å®Ÿè¡Œï¼ˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
  setTimeout(() => resizeWindowSmoothly(targetWidth), 50);
}

// ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«æœ€å°ã‚µã‚¤ã‚ºã«ãƒªã‚µã‚¤ã‚ºã—ã¦ã‹ã‚‰æœ€çµ‚ã‚µã‚¤ã‚ºã«å¤‰æ›´
function handlePageLoad() {
  // æœ€åˆã«ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚µã‚¤ã‚ºã‚’æœ€å°å¹…ã«è¨­å®šï¼ˆæœ€åˆã®èª­ã¿è¾¼ã¿æ™‚ã«æœ€å°ã«ãƒªã‚µã‚¤ã‚ºï¼‰
  window.resizeTo(initialWidth, window.innerHeight);

  // ãã®å¾Œã€å°‘ã—é…å»¶ã—ã¦ã‹ã‚‰ã€ç¾åœ¨ã®ç”»é¢å¹…ã«ãƒªã‚µã‚¤ã‚ºå‡¦ç†ã‚’é–‹å§‹
  setTimeout(() => resizeWindowSmoothly(window.innerWidth), 100);
}



    </script>
  </body>
</html>
