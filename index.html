<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>深影さんの歌枠検索/再生サイト</title>
  <meta name="description" content="夜空テーマの歌アーカイブ。オリジナル・カバー・紹介動画を検索・連続再生できます。" />
  <style>
    /* Reset-ish */   
    :root{
      --background-image: url(./stars_bg.webp) center / cover no-repeat fixed;
      --panel: rgba(4, 187, 243, 0.315);
      --muted:#c6d0da;
      --accent:#7bb6ff; /* light blue accent, could be fan-mark color */
      --glass: rgba(255, 255, 255, 0.03);
      --card:#291b1b;
      --titles:#ffffff;
      --radius:12px;
      --max-width:1100px;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", "Noto Sans JP", "Hiragino Kaku Gothic ProN", "Yu Gothic", "Meiryo", sans-serif;
    }
    html,body{height:100%;margin:0;background:var(--background-image);}

    .container{max-width:var(--max-width);margin:2px auto;padding:20px}

    header.site-header{position: fixed;z-index: 1000;display:flex;align-items:center;justify-content:space-between;gap:16px;padding:14px 18px;border-radius:14px;}
    .brand{display:flex;align-items:center;gap:12px}
    .brand h1{margin:0;font-size:18px;letter-spacing:0.02em}
    nav.main-nav{display:flex;gap:18px;align-items:center}
    nav a{color:var(--muted);text-decoration:none;padding:6px 10px;border-radius:8px}
    nav a.active, nav a:hover{font-weight: bold;color:#ffffff;}

    main{margin-top:60px}

    section.block{height: 25vh;overflow: hidden;margin-top: 12px;padding: 10px;border-radius: 12px;background: var(--panel);display: flex;flex-direction: column;background:var(--panel)}
    .block h2{margin:0 0 12px 0;font-size:20px;color:var(--titles);}

    /* grid for video cards */
    .grid {flex: 1;display: flex;overflow-x: auto;gap: 10px;scroll-snap-type: x mandatory;}
    .card {flex: 0 0 320px;background: var(--card);border-radius: 10px;padding: 8px;scroll-snap-align: start;display: flex;flex-direction: column;justify-content: flex-start;overflow: hidden;}
    .thumb{background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));height:120px;border-radius:8px;display:flex;align-items:center;justify-content:center;border:1px solid rgba(255,255,255,0.02)}
    .meta{font-size:14px;color:var(--muted)}
    .title-small{font-weight:600}

    .yt-player {position: relative;width: 100%;aspect-ratio: 16 / 9;border-radius: 8px;overflow: hidden;}
    .yt-player iframe {position: absolute;top: 0;left: 0;width: 100%;height: 100%;border: none;}

    /* player bar */
    .player-bar{position:fixed;left:50%;transform:translateX(-50%);bottom:18px;width:calc(100% - 40px);max-width:1000px;padding:10px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));display:flex;align-items:center;gap:12px;box-shadow:0 8px 30px rgba(2,6,10,0.6)}
    .player-thumb{width:64px;height:64px;border-radius:8px;background:rgba(255,255,255,0.02)}
    .player-info{flex:1}
    .player-controls{display:flex;gap:8px;align-items:center}
    button.btn{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 10px;border-radius:10px;color:#fff;cursor:pointer}
    button.btn.primary{background:var(--accent);color:#061225;border:none}

    /* song list / table */
    table{width:100%;border-collapse:collapse}
    th,td{padding:10px;text-align:left;border-bottom:1px solid rgba(255,255,255,0.03);color:var(--muted)}
    th{color:#fff}

    /* responsive */
    @media (max-width:900px){
      .grid{grid-template-columns:repeat(2,1fr)}
      .hero{flex-direction:column;align-items:flex-start}
      .hero .title{font-size:34px}
    }
    @media (max-width:480px){
      .container{padding:12px;margin:12px}
      nav.main-nav{display:none}
      header.site-header{padding:12px}
      .grid{grid-template-columns:1fr}
      .player-bar{left:12px;transform:none;width:calc(100% - 24px)}
    }

    /* utility */
    .muted{color:var(--muted)}
    .right{margin-left:auto}
    .hidden{display:none}
  </style>
</head>
<body>

  <div class="container">
    <header class="site-header">

      <nav class="main-nav" aria-label="メインナビ">
        <a href="#" data-view="home" class="active">トップ</a>
        <a href="search.html" data-view="list">歌一覧</a>
      </nav>
    </header>

    <main id="app">
      <!-- Home view -->
      <section id="view-home" class="view">

        <section class="block" aria-labelledby="orig-title">
          <h2 id="orig-title">Original Songs</h2>
          <div class="grid" id="orig-grid"></div>
        </section>

        <section class="block" aria-labelledby="cover-title">
          <h2 id="cover-title">Cover Songs</h2>
          <div class="grid" id="cover-grid"></div>
        </section>

        <section class="block" aria-labelledby="intro-title">
          <h2 id="intro-title">Group Songs</h2>
          <div class="grid" id="intro-grid"></div>
        </section>

      </section>

      
    </main>

  </div>

  <script>
    // Minimal data model (replace with real data or generate at build time)
    const VIDEOS = [
      {title: 'ロストメモリー',type:'original',youtubeId: 'QjULtzL4zb4'},
      {title: 'ゴーストレタッチ',type:'original',youtubeId: 'c6I-bWqApXc'},
      {title: '快晴',type:'cover',youtubeId: '2YpUBL04rzo'},
      {title: 'Over Myth',type:'group',youtubeId: '8Wy_S3ZzYl8'},
    ];

    const playerData = []; // プレイヤーの設定用に保持

    const grid = document.getElementById('orig-grid');



    var tag = document.createElement('script');
  tag.src = "https://www.youtube.com/iframe_api";
  var firstScriptTag = document.getElementsByTagName('script')[0];
  firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

  const players = {};

  function onYouTubeIframeAPIReady() {
  // プレイヤー情報を作る前に HTML を構築
  renderHome();

  playerData.forEach((item) => {
    players[item.id] = new YT.Player(item.id, {
      videoId: item.videoId,
      playerVars: {
        autoplay: 0,
        controls: 1,
        rel: 0,
        modestbranding: 1
      }
    });
  });
}



    // Simple state
    let playlist = [];
    let currentIndex = -1;
    let isPlaying = false;
    let isShuffle = false;
    let isLoop = false;

    // View switching
    const views = ['home','list'];
    function showView(name){
      views.forEach(v=>{
        const el = document.getElementById('view-'+v);
        if(!el) return;
        if(v===name) el.classList.remove('hidden'); else el.classList.add('hidden');
      });
      // update nav
      document.querySelectorAll('nav.main-nav a').forEach(a=>a.classList.toggle('active', a.dataset.view===name));
    }

    // render grids
    function makeCard(video, index) {
  const el = document.createElement('div');
  el.className = 'card';

  const playerDiv = document.createElement('div');
  const playerId = `player-${index}`;
  playerDiv.id = playerId;
  playerDiv.className = 'yt-player';

  const iframe = document.createElement('iframe');
  iframe.src = `https://www.youtube.com/embed/${video.youtubeId}?rel=0&modestbranding=1`;
  iframe.allow = "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share";
  iframe.allowFullscreen = true;

  playerDiv.appendChild(iframe);
  el.appendChild(playerDiv);

  return { element: el, playerId: playerId, videoId: video.youtubeId };
}



    function renderHome() {
  const orig = document.getElementById('orig-grid'); orig.innerHTML = '';
  const cover = document.getElementById('cover-grid'); cover.innerHTML = '';
  const intro = document.getElementById('intro-grid'); intro.innerHTML = '';
  playerData.length = 0; // ← 前回のデータをクリア

  VIDEOS.forEach((v, index) => {
    const c = makeCard(v, index);
    playerData.push({
      id: c.playerId,
      videoId: c.videoId
    });

    if (v.type === 'original') orig.appendChild(c.element);
    else if (v.type === 'cover') cover.appendChild(c.element);
    else if (v.type === 'group') intro.appendChild(c.element);
  });
}


    function renderList(){
      const cards = document.getElementById('list-cards'); cards.innerHTML='';
      const tbody = document.getElementById('table-body'); tbody.innerHTML='';
      const artistSet = new Set(['all']);
      VIDEOS.forEach(v=>artistSet.add(v.artist));
      const filterArtist = document.getElementById('filter-artist'); filterArtist.innerHTML='';
      Array.from(artistSet).forEach(a=>{
        const opt = document.createElement('option'); opt.value=a; opt.textContent=a; filterArtist.appendChild(opt);
      });

      VIDEOS.forEach(v=>{
        cards.appendChild(makeCard(v));
        const tr = document.createElement('tr');
        tr.innerHTML=`<td>${v.title}</td><td>${v.artist}</td><td>${v.date}</td><td>${v.type}</td>`;
        tbody.appendChild(tr);
      });
    }

    function renderSearchResults(q){
      const out = document.getElementById('search-results'); out.innerHTML='';
      if(!q) return;
      const qlow = q.toLowerCase();
      const results = VIDEOS.filter(v=>v.title.toLowerCase().includes(qlow) || v.artist.toLowerCase().includes(qlow));
      if(results.length===0){ out.textContent='見つかりませんでした'; return; }
      const list = document.createElement('div'); list.className='grid';
      results.forEach(r=>list.appendChild(makeCard(r)));
      out.appendChild(list);
    }

    // Player
    function setPlayerInfo(v){
      document.getElementById('player-title').textContent = v? v.title : '再生されていません';
      document.getElementById('player-sub').textContent = v? v.artist + ' · ' + v.date : '';
    }

    function playQueue(arr, start=0){
      playlist = arr.slice();
      currentIndex = start;
      isPlaying = true;
      // In a static mock, we don't play real audio — but update UI
      updatePlayerUI();
      // simulate "playing" by highlighting current
      setPlayerInfo(playlist[currentIndex]);
    }

    function playSingle(v){
      playQueue([v],0);
    }

    function updatePlayerUI(){
      document.getElementById('play-btn').textContent = isPlaying? '⏸' : '▶';
      document.getElementById('loop-btn').textContent = isLoop? '連続(ON)' : '連続';
      document.getElementById('shuffle-btn').textContent = isShuffle? 'ランダム(ON)' : 'ランダム';
    }

    function nextTrack(){
      if(playlist.length===0) return;
      if(isShuffle){
        currentIndex = Math.floor(Math.random()*playlist.length);
      } else {
        currentIndex++;
        if(currentIndex>=playlist.length){
          if(isLoop) currentIndex=0; else { isPlaying=false; updatePlayerUI(); return; }
        }
      }
      setPlayerInfo(playlist[currentIndex]);
    }
    function prevTrack(){
      if(playlist.length===0) return;
      currentIndex = Math.max(0, currentIndex-1);
      setPlayerInfo(playlist[currentIndex]);
    }

    // helpers
    function allVideosSorted(){
      return VIDEOS.slice().sort((a,b)=> new Date(b.date) - new Date(a.date));
    }

    // events bind
    document.addEventListener('DOMContentLoaded', ()=>{
      // initial render
      renderList();

      // nav
      document.querySelectorAll('nav.main-nav a').forEach(a=>{
        a.addEventListener('click', (e)=>{ e.preventDefault(); showView(a.dataset.view); });
      });
      document.getElementById('home-link').addEventListener('click', (e)=>{ e.preventDefault(); showView('home'); });
      document.getElementById('menu-toggle').addEventListener('click', ()=>{
        const nav = document.querySelector('nav.main-nav'); nav.style.display = nav.style.display==='flex' ? 'none' : 'flex';
      });

      // home play buttons
      document.getElementById('play-all-home').addEventListener('click', ()=> playQueue(allVideosSorted()));
      document.getElementById('shuffle-home').addEventListener('click', ()=> { isShuffle=true; playQueue(allVideosSorted()); updatePlayerUI(); });

      // list controls
      document.getElementById('toggle-list-mode').addEventListener('click', ()=>{
        const table = document.getElementById('list-table'); const cards = document.getElementById('list-cards');
        const showingCards = cards.classList.contains('hidden') === false;
        if(showingCards){ cards.classList.add('hidden'); table.classList.remove('hidden'); document.getElementById('toggle-list-mode').textContent='テーブル表示'; }
        else { cards.classList.remove('hidden'); table.classList.add('hidden'); document.getElementById('toggle-list-mode').textContent='カード表示'; }
      });
      document.getElementById('play-all-list').addEventListener('click', ()=> playQueue(allVideosSorted()));
      document.getElementById('shuffle-list').addEventListener('click', ()=> { isShuffle=true; playQueue(allVideosSorted()); updatePlayerUI(); });

      // search
      document.getElementById('search-btn').addEventListener('click', ()=> { const q = document.getElementById('global-search').value.trim(); renderSearchResults(q); showView('search'); });
      document.getElementById('global-search').addEventListener('keyup', (e)=>{ if(e.key==='Enter'){ document.getElementById('search-btn').click(); } });

      // player controls
      document.getElementById('play-btn').addEventListener('click', ()=>{ isPlaying=!isPlaying; updatePlayerUI(); });
      document.getElementById('next-btn').addEventListener('click', ()=> nextTrack());
      document.getElementById('prev-btn').addEventListener('click', ()=> prevTrack());
      document.getElementById('shuffle-btn').addEventListener('click', ()=>{ isShuffle=!isShuffle; updatePlayerUI(); });
      document.getElementById('loop-btn').addEventListener('click', ()=>{ isLoop=!isLoop; updatePlayerUI(); });

      // initial view
      showView('home'); updatePlayerUI();
    });

  </script>
</body>
</html>
